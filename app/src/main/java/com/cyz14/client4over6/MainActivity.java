package com.cyz14.client4over6;import android.content.Context;import android.content.Intent;import android.net.ConnectivityManager;import android.net.NetworkInfo;import android.net.wifi.WifiInfo;import android.net.wifi.WifiManager;import android.os.Bundle;import android.support.v7.app.ActionBarActivity;import android.util.Log;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.widget.Button;import android.widget.TextView;import android.widget.Toast;import java.net.InetAddress;import java.net.NetworkInterface;import java.net.SocketException;import java.util.Enumeration;public class MainActivity extends ActionBarActivity {    int MAX_BUF = 1024;    int ipPipeFlag = 0;    public static String macAddr;    public static String ipv6Addr;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        Button connectButton = (Button) findViewById(R.id.ConnectButton);        connectButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Toast.makeText(MainActivity.this, "Trying to start VPN Service",                        Toast.LENGTH_LONG).show();                startVPNService();            }        });        Button disconnectButton = (Button) findViewById(R.id.DisconnectButton);        disconnectButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(MainActivity.this, MyVPNService.class);                stopService(intent);            }        });        Button checkButton = (Button) findViewById(R.id.CheckButton);        checkButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                Toast.makeText(MainActivity.this, "Checking net status...", Toast.LENGTH_LONG).show();                checkNetStatus();            }        });        Button finishButton  = (Button) findViewById(R.id.FinishButton);        finishButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                finish();            }        });    }    private boolean isNetConnected() {        ConnectivityManager connectivityManager =                (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);        if (connectivityManager != null) {            NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();            if (networkInfo != null) {                if (networkInfo.isConnected()) {                    return true;                }            }        }        return false;    }    // check if wifi connected    private boolean isWifiConnected() {        ConnectivityManager connectivityManager = (ConnectivityManager)                getSystemService(Context.CONNECTIVITY_SERVICE);        if (connectivityManager != null) {            NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();            if (networkInfo != null && networkInfo.getType() == ConnectivityManager.TYPE_WIFI) {                return true;            }        }        return false;    }    private void checkNetStatus() {        TextView statusTextView = (TextView) findViewById(R.id.NetworkStatusTextView);        if (!isNetConnected()) {            Toast.makeText(this, "You are not connected to network", Toast.LENGTH_LONG).show();            statusTextView.setText("You are not connected to network");            return;        }        if (!isWifiConnected()) {            Toast.makeText(this, "You are not connected by WiFi", Toast.LENGTH_LONG).show();            statusTextView.setText("You are not connected by WiFi");            return;        }        statusTextView.setText("You are connected by WiFi");        macAddr = getMacAddress();        TextView macTextView = (TextView) findViewById(R.id.MacTextView);        macTextView.setText(macAddr);        ipv6Addr = getIPv6Address();        TextView textView = (TextView)findViewById(R.id.IPv6AddressTextView);        textView.setText(ipv6Addr);        Log.d("IPAddress", ipv6Addr);    }    private String getMacAddress() {        WifiManager wifiManager = (WifiManager) getSystemService(WIFI_SERVICE);        WifiInfo wifiInfo = wifiManager.getConnectionInfo();        return wifiInfo.getMacAddress();    }    private String getIPv6Address() {        try {            final Enumeration<NetworkInterface> e = NetworkInterface.getNetworkInterfaces();            while (e.hasMoreElements()) {                final NetworkInterface networkInterface = e.nextElement();                for (Enumeration<InetAddress> enumAddress = networkInterface.getInetAddresses();                     enumAddress.hasMoreElements();) {                    InetAddress inetAddress = enumAddress.nextElement();                    if ( !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {                        return inetAddress.getHostAddress();                    }                }            }        } catch (SocketException e) {            Log.wtf("WIFI_IP", "Unable to NetworkInterface.getNetworkInterfaces()");        }        return null;    }    private boolean startVPNService() {        Intent intent = new Intent(MainActivity.this, MyVPNService.class);        startService(intent);        return true;    }    @Override    public boolean onCreateOptionsMenu(Menu menu) {        // Inflate the menu; this adds items to the action bar if it is present.        getMenuInflater().inflate(R.menu.menu_main, menu);        return true;    }    @Override    public boolean onOptionsItemSelected(MenuItem item) {        // Handle action bar item clicks here. The action bar will        // automatically handle clicks on the Home/Up button, so long        // as you specify a parent activity in AndroidManifest.xml.        int id = item.getItemId();        //noinspection SimplifiableIfStatement        if (id == R.id.action_settings) {            return true;        }        return super.onOptionsItemSelected(item);    }}